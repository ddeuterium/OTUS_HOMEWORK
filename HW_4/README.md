# **Домашнее задание №4: Загрузка системы:**


## Работа с загрузчиком

-  Попасть в систему без пароля несколькими способами
-  Установить систему с LVM, после чего переименовать VG
-  Добавить модуль в initrd


## **Ход выполнения:**

- **Попасть в систему без пароля несколькими способами:**

*При выборе ядра для загрузки нажимаем **"E"**, попадаем в окно, где можем менять параметры загрузки:*

### Способ 1. init=/bin/sh

 В конце строки начинающейся с **linux** добавляем **init=/bin/sh** или **init=/bin/bash**и нажимаем **сtrl-x** для
загрузки в систему


![Screen_1_a](./screens/Screen_1_a.JPG)
**1**
![Screen_1_b](./screens/Screen_1_b.JPG)
**2**
![Screen_1_c](./screens/Screen_1_c.JPG)
**3**

*Корневая файловая система монтируется в режиме Read-Only. Для перемонтирования ее в
режим Read-Write можно воспользоваться командой:*
```
    mount -o remount,rw /
```
*Или же можно заменить в параметрах загрузки **ro** - *read only* на **rw** - *read-write*

*Способы с **rd.break** и **rw init=/sysroot/bin/sh** в **Linux Mint (Ubuntu)** не работают

### Способ 2. rd.break
В конце строки начинающейся с **linux16** добавляем **rd.break** и нажимаем **сtrl-x** для
загрузки в систему.
Попадаем в **emergency mode**. Корневая файловая система смонтирована в режиме **Read-Only**. 

Для замены пароля администратора:
```
chroot /sysroot
mount -o remount,rw /sysroot
passwd root
touch /.autorelabel
```
Перезагружаемся и заходим в систему с новым паролем. 

### Способ 3. rw init=/sysroot/bin/sh
В строке начинающейся с **linux16** заменяем **ro** на **rw init=/sysroot/bin/sh** и нажимаем **сtrl-x**
для загрузки в систему.
Файловая система уже смонтирована в режим **Read-Write**


## Установить систему с LVM, после чего переименовать VG

Cмотрим текущее состояние системы и переименовываем VG:

![Screen_4_a](./screens/Screen_4_a.JPG)

Правим [/etc/fstab](files/fstab), [/etc/default/grub](files/grub), [/boot/grub2/grub.cfg](files/grub.cfg) 
Меняем название на новое. 
Пересоздаем **initrd image**, чтобы он знал новое название Volume Group

![Screen_4_b](./screens/Screen_4_b.JPG)

● После чего можем перезагружатþсā и если все сделано правилþно успешно грузимсā с
новýм именем Volume Group и проверāем:
[root@otuslinux ~]# vgs
 VG #PV #LV #SN Attr VSize VFree
 OtusRoot 1 2 0 wz--n- <38.97g 0
● При желании можно так же заменитþ название Logical Volume
Добавить модуль в initrd
Скриптý модулей хранāтсā в каталоге /usr/lib/dracut/modules.d/. Длā того чтобý
добавитþ свой модулþ создаем там папку с именем 01test:
[root@otuslinux ~]# mkdir /usr/lib/dracut/modules.d/01test
В нее поместим два скрипта:
1. module-setup.sh - которýй устанавливает модулþ и вýзýвает скрипт test.sh
2. test.sh - собственно сам вýзýваемýй скрипт, в нём у нас рисуетсā пингвинчик
Примерý файлов по ссýлкам.
Добавить модуль в initrd
● Пересобираем образ initrd
[root@otuslinux ~]# mkinitrd -f -v /boot/initramfs-$(uname -r).img $(uname -r)
или
[root@otuslinux ~]# dracut -f -v
● Можно проверитþ/посмотретþ какие модули загруженý в образ:
[root@otuslinux ~]# lsinitrd -m /boot/initramfs-$(uname -r).img | grep test
test
● После чего можно пойти двумā путāми длā проверки:
○ Перезагрузитþсā и руками вýклĀчитþ опции rghb и quiet и увидетþ вýвод
○ Либо отредактироватþ grub.cfg убрав ÿти опции
● В итоге при загрузке будет пауза на 10 секунд и вý увидите пингвина в вýводе
терминала



